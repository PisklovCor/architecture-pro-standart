### **Название задачи:** Интеграция ставок с кол-центром для консультирования клиентов
### **Автор:** Архитектор банка "Стандарт"
### **Дата:** 01.09.2025

### **Функциональные требования**

Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|UC1|Сотрудник кол-центра банка|Консультирование по актуальным ставкам депозитов|1. Клиент звонит в кол-центр банка с вопросами по депозитам<br/>2. Сотрудник авторизуется в системе кол-центра<br/>3. Открывает модуль "Депозитные ставки"<br/>4. Просматривает актуальные ставки по всем типам депозитов<br/>5. Консультирует клиента по условиям<br/>6. При необходимости создает обращение для персональных ставок|
|UC2|Система управления ставками|Передача актуальных ставок в кол-центр|1. Система ежедневно рассчитывает актуальные ставки<br/>2. Публикует обновленные ставки через API<br/>3. Кол-центр получает уведомление об обновлении<br/>4. Система кол-центра обновляет локальный справочник ставок<br/>5. Логирует факт успешного обновления|
|UC3|Партнерский кол-центр|Получение ставок через файловый обмен|1. Система управления ставками ежедневно генерирует файл с актуальными ставками<br/>2. Файл загружается на SFTP-сервер в указанную директорию<br/>3. Партнерский кол-центр забирает файл по расписанию<br/>4. Импортирует ставки в свою систему<br/>5. Подтверждает получение через статусный файл|
|UC4|Сотрудник партнерского кол-центра|Консультирование клиентов по ставкам|1. Клиент звонит в партнерский кол-центр<br/>2. Сотрудник открывает справочник депозитных ставок<br/>3. Предоставляет информацию по актуальным условиям<br/>4. При необходимости переадресовывает на банк для оформления<br/>5. Фиксирует обращение в своей CRM-системе|
|UC5|Администратор системы|Мониторинг передачи ставок|1. Проверяет успешность ежедневной синхронизации ставок<br/>2. Контролирует статус получения файлов партнерами<br/>3. При сбоях инициирует повторную отправку<br/>4. Ведет отчетность по качеству интеграции<br/>5. Настраивает уведомления о проблемах|

### **Нефункциональные требования**

Опишите здесь нефункциональные требования и архитектурно значимые требования.

|**№**|**Требование**|
| :-: | :- |
|NFR1|**Актуальность данных**: Ставки в кол-центре должны обновляться ежедневно автоматически, максимальная задержка - 1 час|
|NFR2|**Производительность**: API получения ставок должно отвечать за время не более 200 мс|
|NFR3|**Надежность**: Доступность сервиса передачи ставок 99,5%, с автоматическим повтором при сбоях|
|NFR4|**Безопасность**: Передача ставок только по защищенным каналам (HTTPS для API, SFTP для файлов)|
|NFR5|**Совместимость**: Интеграция с существующей системой кол-центра без изменения ее ядра|
|NFR6|**Файловый формат**: Поддержка JSON и CSV форматов для партнерского кол-центра|
|NFR7|**Мониторинг**: Логирование всех операций передачи ставок с возможностью аудита|
|NFR8|**Восстановление**: Возможность переотправки данных за любую дату в случае сбоев|

### **Решение**

#### Концептуальная архитектура интеграции с кол-центрами

**Принципы архитектурных решений:**

1. **Централизованное управление ставками** - единый источник актуальных ставок для всех каналов
2. **Минимальная доработка кол-центра** - используем возможности расширения существующей платформы
3. **Безопасная передача данных** - все интеграции только по защищенным каналам
4. **Автоматизация процесса** - исключение ручной передачи Excel-файлов

#### Основные компоненты решения:

**1. Расширение сервиса управления ставками**
- Технологии: ASP.NET Core, MS SQL
- Новые функции: API для кол-центра, генерация файлов для партнеров
- Ежедневная публикация актуальных ставок

**2. API интеграции для кол-центра банка**
- REST API с методами получения ставок по типам депозитов
- Интеграция через существующие возможности платформы Java Spring Boot
- Кэширование ставок в системе кол-центра

**3. SFTP-сервис для партнерского кол-центра**
- Автоматическая генерация файлов в форматах JSON/CSV
- Безопасная передача через SFTP-протокол
- Контроль получения через статусные файлы

**4. Система мониторинга интеграций**
- Отслеживание успешности передачи ставок
- Уведомления при сбоях
- Возможность ручной переотправки

#### Интеграционная схема:

```
Сервис управления ставками
    ↓ (REST API, HTTPS)
Система кол-центра банка → Сотрудники кол-центра
    
Сервис управления ставками  
    ↓ (SFTP, ежедневно)
SFTP-сервер → Партнерский кол-центр → Сотрудники партнеров
```

#### Диаграммы архитектуры:
- `call_center_context_diagram.drawio` - диаграмма контекста с кол-центрами
- `call_center_container_diagram.drawio` - диаграмма компонентов интеграции

#### Обоснование технологических решений:

**REST API** - соответствует архитектуре микросервисов, простая интеграция с Java-платформой кол-центра

**SFTP** - требование партнерского кол-центра, обеспечивает безопасную передачу файлов

**JSON/CSV форматы** - универсальные форматы, поддерживаемые большинством систем

**Кэширование в кол-центре** - снижение нагрузки на API, обеспечение работы при временных сбоях

### **Альтернативы**

#### Альтернатива 1: Прямая интеграция с АБС
**Описание:** Предоставление кол-центру прямого доступа к ставкам через АБС
**Преимущества:** Отсутствие промежуточных систем
**Недостатки:** Нарушение принципа изоляции АБС, риски безопасности

#### Альтернатива 2: Email-рассылка файлов
**Описание:** Отправка ставок партнерам по email вместо SFTP
**Преимущества:** Простота реализации
**Недостатки:** Низкий уровень безопасности, ручной процесс импорта

#### Альтернатива 3: Единая система для всех кол-центров
**Описание:** Предоставление партнерам доступа к веб-интерфейсу банка
**Преимущества:** Централизованное управление
**Недостатки:** Сложности с доступами, зависимость от банковской инфраструктуры

### **Недостатки, ограничения, риски**

#### Недостатки выбранного решения:
1. **Дублирование данных** - ставки хранятся в нескольких системах
2. **Сложность синхронизации** - необходимость контроля актуальности во всех системах
3. **Зависимость от внешних систем** - сбои в кол-центрах могут прервать консультирование

#### Ограничения:
1. **Технические ограничения партнеров** - только файловый обмен, отсутствие API
2. **Регламент обновления** - ставки обновляются только 1 раз в день
3. **Форматы данных** - ограничения на структуру передаваемых файлов

#### Риски:
1. **Риск десинхронизации** - различия в ставках между системами при сбоях
2. **Операционный риск** - некорректные консультации при устаревших данных
3. **Безопасность** - риск утечки коммерческой информации при передаче ставок
4. **Производительность** - увеличение нагрузки на сервис управления ставками
5. **Интеграционные сбои** - влияние проблем с кол-центрами на основные бизнес-процессы
